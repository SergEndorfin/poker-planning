<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta th:replace="fragments/common/head">
    <title>Poker Planning Session</title>
    <script th:src="@{/js/delete_session.js}"></script>
</head>
<body>
<header th:insert="fragments/common/header"></header>
<main class="content  mb-5">
    <div class="container">
        <div class="mt-3 mb-1">
            <div class="row align-items-center justify-content-between">
                <div class="col-auto">
                    <p class="mb-0">Invitation URL:</p>
                    <p><a th:href="${inviteUrl}" target="_blank"><span th:text="${inviteUrl}"></span></a></p>
                </div>
                <div class="col-auto">
                    <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addUserStoryModal">
                        Add User Story
                    </button>
                </div>
                <div class="col-auto">
                    <button class="btn btn-danger mb-3"
                            th:with="url=@{/sessions/{id}(id=${planingSession.id})}"
                            th:onclick="sendDeleteSession([[${url}]])">Destroy Session
                    </button>
                </div>
            </div>
        </div>
        <hr class="my-0">
        <div class="container text-center my-2">
            <div class="row">
                <div class="col">
                    <h1 class="my-4">Poker Planning Session: <b><span th:text="${planingSession.title}"></span></b></h1>
                    <h2 class="my-4">Deck Type: <b><span th:text="${planingSession.deckType}"></span></b></h2>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-9">
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>User Stories to Vote</h4>
                    </div>
                    <!---->
                    <table class="table">
                        <thead>
                        <tr>
                            <th>User Story ID</th>
                            <th>Description</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="userStory : ${planingSession.userStories}">
                            <td th:text="${userStory.id}">User Story ID</td>
                            <td th:text="${userStory.description}">User Story Description</td>
                            <td th:text="${userStory.status}">User Story Status</td>
                            <td>
                                <button
                                        onclick="startVoting(/* pass the userStory.id here */)"
                                        th:disabled="${userStory.status.name() == 'VOTED'}"
                                        class="btn btn-primary mb-1">Start
                                </button>
                                <form id="redirectForm" th:action="@{/user-stories/{id}(id=${userStory.id})}"
                                      method="post">
                                    <input type="hidden" id="referer" name="sessionId"
                                           th:value="${planingSession.id}"/>
                                    <button class="btn btn-danger">Remove</button>
                                </form>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <!---->
                </div>
            </div>
            <div class="col-lg-3">
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>Members Joined</h4>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item" th:each="user : ${planingSession.users}">
                            <span th:text="${user.username}"></span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Creating a new User Story pop-up form-->
    <div th:include="/fragments/user-story/create_story_form"></div>
</main>
<footer th:insert="fragments/common/footer"></footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.min.js"></script>
</body>
</html>
